syntax = "proto3";

package apollo.proto.agent.v1;

import "google/protobuf/struct.proto";

option go_package = "github.com/dennishilgert/apollo/pkg/proto/agent/v1;agent";

service Agent {
  rpc Invoke(InvokeRequest) returns (InvokeResponse) {}
}

message InvokeRequest {
  string id = 1;
  string type = 2;
  FunctionSpecs function = 3;
  RuntimeSpecs runtime = 4;
  oneof data {
    HTTPRequestData http_data = 5;
  }
}

message FunctionSpecs {
  string id = 1;
  int32 memory_limit = 2;
  int32 vcpu_cores = 3;
}

message RuntimeSpecs {
  string name = 1;
  string version = 2;
  string handler = 3;
  string binary_path = 4;
  repeated string binary_args = 5;
}

message HTTPRequestData {
  string method = 1;
  string path = 2;
  string source_ip = 3;
  map<string, string> headers = 4;
  map<string, string> query_params = 5;
  google.protobuf.Struct body = 6;
}

message InvokeResponse {
  string request_id = 1;
  int32 status = 2;
  string status_message = 3;
  string duration = 6;
  repeated google.protobuf.Struct logs = 4;
  google.protobuf.Struct data = 5;
}